(this["webpackJsonpdrink-up-front-user"]=this["webpackJsonpdrink-up-front-user"]||[]).push([[0],{53:function(e,t,n){},54:function(e,t,n){},83:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"signIn",(function(){return p})),n.d(a,"setIsAuthenticated",(function(){return m})),n.d(a,"signOut",(function(){return v})),n.d(a,"updateInput",(function(){return g})),n.d(a,"clearInput",(function(){return x})),n.d(a,"getUserData",(function(){return T}));n(48);var r,c=n(0),s=n.n(c),i=n(25),u=n.n(i),o=(n(53),n(54),n(12)),l=n(6),d=n(11),b=n.n(d),j=n(18);!function(e){e.SIGNIN="SIGNIN",e.SIGNOUT="SIGNOUT",e.SET_IS_AUTHENTICATED="SET_IS_AUTHENTICATED",e.UPDATE_INPUT="UPDATE_INPUT",e.CLEAR_INPUT="CLEAR_INPUT",e.USE_INJECTION="USE_INJECTION",e.GET_USER_DATA="GET_USER_DATA"}(r||(r={}));var h,f,O=n(7),p=function(e,t,n,a){return a.preventDefault(),function(){var a=Object(j.a)(b.a.mark((function a(r){return b.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.signIn(e,t);case 2:r(m(!0)),r(Object(O.e)("/dashboard"));case 4:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()},m=function(e){return{type:r.SET_IS_AUTHENTICATED,status:e}},v=function(e){return function(){var t=Object(j.a)(b.a.mark((function t(n){return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.signOut(),n(m(!1)),n(Object(O.d)("/"));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},g=function(e,t){return function(n){n({type:r.UPDATE_INPUT,value:e,inputName:t})}},x=function(){return function(e){e({type:r.CLEAR_INPUT,inputValue:""})}},T=function(e,t){return function(){var n=Object(j.a)(b.a.mark((function n(a){var c;return b.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getUserData(e);case 2:c=n.sent,a({type:r.GET_USER_DATA,user:c});case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},N=n(10),I=n(47),A=n(16),k=n(21),w=n(35),E=n(26),S=n(8),U={isAuthenticated:!1,credentials:{username:"",password:""},user:{},inputValue:""},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case r.SIGNIN:return Object(S.a)(Object(S.a)({},e),{},{username:t.username});case r.SIGNOUT:return Object(S.a)(Object(S.a)({},e),{},{isAuthenticated:t.isAuthenticated});case r.SET_IS_AUTHENTICATED:return Object(S.a)(Object(S.a)({},e),{},{isAuthenticated:t.status});case r.GET_USER_DATA:return Object(S.a)(Object(S.a)({},e),{},{user:t.user});case r.UPDATE_INPUT:var n=t.inputName;return Object(S.a)(Object(S.a)({},e),{},{credentials:Object(E.a)({},n,t.value)});case r.CLEAR_INPUT:return Object(S.a)(Object(S.a)({},e),{},{inputValue:t.inputValue});default:return Object(S.a)({},e)}},y=Object(A.a)(),D=Object(N.c)({router:Object(k.b)(y),user:_}),C=Object(N.d)(D,Object(N.a)(Object(w.a)(y),I.a)),P=n(13),F=n(85),G=Object(F.a)()(h=function e(){Object(P.a)(this,e)})||h,L=n(1),R=function(e){e.isAuthenticated;var t=Object(o.useInjection)(G),n=Object(l.d)(),r=Object(N.b)(a,n),c=r.signIn,s=r.updateInput,i=Object(l.e)((function(e){return e.user}));Object(l.e)((function(e){return e.user.isAuthenticated}));return Object(L.jsxs)("div",{className:"pt-2 container w-50",children:[Object(L.jsx)("h1",{className:"py-5",children:"Formulaire de connexion"}),Object(L.jsxs)("form",{onSubmit:function(e){return c(e.currentTarget.username.value,e.currentTarget.password.value,t,e)},children:[Object(L.jsxs)("div",{className:"form-group d-flex justify-content-center",children:[Object(L.jsx)("label",{htmlFor:"username",className:"form-label mt-4 mr-4",children:"Adresse email"}),Object(L.jsx)("input",{type:"email",value:i.credentials.username,onChange:function(e){return s(e.currentTarget.value,e.currentTarget.name)},className:"form-control",id:"username","aria-describedby":"emailHelp",placeholder:"Entrez votre adresse email"})]}),Object(L.jsxs)("div",{className:"form-group d-flex justify-content-center mt-4",children:[Object(L.jsx)("label",{htmlFor:"password",className:"form-label mt-4 ",children:"Mot de passe"}),Object(L.jsx)("input",{type:"password",value:i.credentials.password,onChange:function(e){return s(e.currentTarget.value,e.currentTarget.name)},className:"form-control",id:"password",placeholder:"Entrez votre mot de passe"})]}),Object(L.jsx)("button",{type:"submit",className:"btn btn-success my-5",children:"Connexion"})]})]})},J=n(27),z=Object(F.a)()(f=function e(){Object(P.a)(this,e)})||f,H=function(){var e=Object(o.useInjection)(G),t=Object(l.d)(),n=Object(N.b)(a,t).signOut,r=Object(l.e)((function(e){return e.user.isAuthenticated}));return Object(L.jsx)("nav",{className:"navbar navbar-expand-lg navbar-dark bg-dark",children:Object(L.jsxs)("div",{className:"container-fluid",children:[Object(L.jsx)("a",{className:"navbar-brand",href:"#",children:"Drink Up !"}),Object(L.jsx)("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarColor02","aria-controls":"navbarColor02","aria-expanded":"false","aria-label":"Toggle navigation",children:Object(L.jsx)("span",{className:"navbar-toggler-icon"})}),Object(L.jsxs)("div",{className:"collapse navbar-collapse",id:"navbarColor02",children:[Object(L.jsxs)("ul",{className:"navbar-nav me-auto",children:[Object(L.jsx)("li",{className:"nav-item",children:Object(L.jsx)("a",{className:"nav-link",href:"#",children:"Nos Plantes"})}),Object(L.jsx)("li",{className:"nav-item",children:Object(L.jsx)("a",{className:"nav-link",href:"#",children:"Pricing"})})]}),r&&Object(L.jsx)(L.Fragment,{children:Object(L.jsx)("ul",{className:" navbar-nav ml-auto",children:Object(L.jsx)("li",{className:"nav-item",children:Object(L.jsx)("button",{onClick:function(){return n(e)},className:"btn btn-success",children:"Deconnexion"})})})})]})]})})},B=function(){var e=Object(o.useInjection)(G),t=e.getAuthenticatedUserId();Object(c.useEffect)((function(){r(t,e)}),[]);var n=Object(l.d)(),r=Object(N.b)(a,n).getUserData,s=Object(l.e)((function(e){return e.user.user})),i=Object(l.e)((function(e){return e.user.isAuthenticated}));return Object(L.jsx)("div",{children:i&&Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)("h1",{children:"Dashboard"}),Object(L.jsxs)("div",{className:"",children:[Object(L.jsx)("h2",{children:s.firstname}),Object(L.jsx)("h2",{children:s.surname})]})]})||Object(L.jsx)("h1",{children:"connexion"})})};var V,M,q=function(){var e=Object(o.useInjection)(z),t=e.isAuthenticated();console.log("authentifi\xe9 au lancement application => "+t),e.setup();var n=Object(l.d)();(0,Object(N.b)(a,n).setIsAuthenticated)(t);var r=Object(l.e)((function(e){return e.user.isAuthenticated}));return console.log("Etat du status de connexion dans state => "+r),Object(L.jsxs)(k.a,{history:y,children:[Object(L.jsx)(H,{}),Object(L.jsx)("main",{className:"App",children:Object(L.jsxs)(J.d,{children:[Object(L.jsx)(J.b,{path:"/",exact:!0,component:R}),Object(L.jsx)(J.b,{path:"/dashboard",render:function(e){return r?Object(L.jsx)(B,{}):Object(L.jsx)(J.a,{to:"/"})}})]})})]})},K=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,87)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),a(e),r(e),c(e),s(e)}))},Q=n(86),W=n(28),X=n(19),Y=n.n(X),Z=n(32),$=Object(F.a)()(V=function(){function e(){Object(P.a)(this,e),this.isAuthenticated=function(){var e=window.localStorage.getItem("authToken");return"undefined"!=e&&null!=e&&1e3*Object(Z.a)(e).exp>(new Date).getTime()}}return Object(W.a)(e,[{key:"setup",value:function(){var e=window.localStorage.getItem("authToken");"undefined"!=e&&null!=e&&(1e3*Object(Z.a)(e).exp>(new Date).getTime()&&this.setAxiosToken(e))}},{key:"setAxiosToken",value:function(e){Y.a.defaults.headers.common.Authorization="Bearer "+e}}]),e}())||V,ee=function e(t,n,a,r,c){Object(P.a)(this,e),this.id=void 0,this.gender=void 0,this.firstname=void 0,this.surname=void 0,this.is_notified=void 0,this.id=t,this.gender=n,this.firstname=a,this.surname=r,this.is_notified=c},te=Object(F.a)()(M=function(){function e(){var t=this;Object(P.a)(this,e),this.protocole="http://",this.domain="drink-up-apiplatform.test:8080",this.url=this.protocole+this.domain,this.getAuthenticatedUserId=function(){var e=window.localStorage.getItem("authToken");return e?t.parseJwt(e).id:null},this.signOut=function(){t.unsetAxiosToken(),t.removeTokenFromLocalStorage()},this.getUserData=function(){var e=Object(j.a)(b.a.mark((function e(n){var a,r,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="/api/users/"+n,e.prev=1,e.next=4,Y.a.get(t.url+a).then((function(e){return e.data}));case 4:return r=e.sent,c=new ee(r.id,r.gender,r.firstname,r.surname,r.is_notified),e.abrupt("return",c);case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0);case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()}return Object(W.a)(e,[{key:"signIn",value:function(){var e=Object(j.a)(b.a.mark((function e(t,n){var a,r,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/api/login_check",a={username:t,password:n},e.prev=2,e.next=5,Y.a.post(this.url+"/api/login_check",a).then((function(e){return e.data}));case 5:r=e.sent,c=r.token,this.setAxiosToken(c),this.storeTokenInLocalStorage(c),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.log("there was an error");case 14:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"storeTokenInLocalStorage",value:function(e){window.localStorage.setItem("authToken",e)}},{key:"removeTokenFromLocalStorage",value:function(){console.log("removed from storage"),window.localStorage.removeItem("authToken")}},{key:"setAxiosToken",value:function(e){Y.a.defaults.headers.common.Authorization="Bearer "+e}},{key:"unsetAxiosToken",value:function(){delete Y.a.defaults.headers.common.Authorization}},{key:"parseJwt",value:function(e){try{return JSON.parse(atob(e.split(".")[1]))}catch(t){return null}}}]),e}())||M,ne=new Q.a;ne.bind(G).to(te),ne.bind(z).to($);var ae=ne;u.a.render(Object(L.jsx)(s.a.StrictMode,{children:Object(L.jsx)(o.Provider,{container:ae,children:Object(L.jsx)(l.a,{store:C,children:Object(L.jsx)(q,{})})})}),document.getElementById("root")),K((function(){}))}},[[83,1,2]]]);
//# sourceMappingURL=main.6ee8918e.chunk.js.map